---
layout: default
title: Appointment Update
permalink: /appointment-update/
---

<h1>Update Appointment</h1>
<p>
  This page reads parameters from the URL and updates the appointment record
  through your secure proxy API (<code>api.asksurgeons.com</code>).
</p>

<div id="result" style="margin-top:20px;">Loading...</div>

<script>
/* ===== CONFIG ===== */
const PROXY_URL = "https://api.asksurgeons.com/appointments";

/* ===== Helper: parse ?key=value from URL ===== */
function getQueryParams() {
  const q = {};
  const parts = window.location.search.replace(/^\?/, '').split('&').filter(Boolean);
  for (const p of parts) {
    const [k, v] = p.split('=').map(decodeURIComponent);
    if (k) q[k] = v === undefined ? '' : v;
  }
  return q;
}

/* ===== Send parameters to Proxy (POST method) ===== */
async function sendToProxy(params) {
  try {
    const resp = await fetch(PROXY_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: new URLSearchParams(params)
    });

    const text = await resp.text();
    let json;
    try {
      json = JSON.parse(text);
    } catch {
      json = { ok: false, raw: text };
    }

    document.getElementById("result").innerHTML = `
      <h3>✅ Response from Server:</h3>
      <pre>${JSON.stringify(json, null, 2)}</pre>
    `;
  } catch (err) {
    document.getElementById("result").innerHTML =
      `<p style="color:red;">❌ Error: ${err.message}</p>`;
  }
}

/* ===== Main Logic ===== */
document.addEventListener("DOMContentLoaded", () => {
  const q = getQueryParams();
  const container = document.getElementById("result");

  // Validate URL parameters
  if (!q.appointmentId) {
    container.innerHTML = `<p style="color:red;">Missing <code>appointmentId</code> in URL.</p>`;
    return;
  }

  // Auto-submit if ?autosubmit=1
  if (q.autosubmit === "1") {
    container.innerHTML = `<p>⏳ Updating appointment <strong>${q.appointmentId}</strong>...</p>`;
    sendToProxy(q);
  } else {
    // Manual confirmation UI
    container.innerHTML = `
      <p>Appointment ID: <strong>${q.appointmentId}</strong></p>
      <p>Status: ${q.newStatus || "—"}</p>
      <div style="margin-top:12px;">
        <label>Doctor Password:
          <input id="password" type="password" style="margin-left:8px; padding:6px;" />
        </label>
      </div>
      <button id="confirmSend"
        style="background:#1D75BC;color:#fff;padding:10px 16px;margin-top:12px;border:0;border-radius:6px;cursor:pointer;">
        Send Update
      </button>
    `;

    document.getElementById("confirmSend").onclick = () => {
      const pw = document.getElementById("password").value.trim();
      if (!pw) {
        alert("Please enter your password before submitting.");
        return;
      }

      // Merge password into query params
      const payload = { ...q, password: pw };
      sendToProxy(payload);
    };
  }
});
</script>

