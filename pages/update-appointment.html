---
layout: basic
title: Confirm Appointment
permalink: /update-appointment/
---

<style>
/* ==== AskSurgeons — Modern Glassmorphic Responsive Form (your provided CSS) ===== */
#patientForm {
  --field-bg: rgba(255, 255, 255, 0.78);
  --field-border: rgba(231, 237, 245, 0.9);
  --ring: rgba(51, 104, 198, 0.25);
  --primary: #007BBF;
  --text: #0f172a;
  --muted: #9aa4b2;

  display: grid;
  display: block;
  max-width: 900px;
  margin-left: auto;
  margin-right: auto;
  margin-bottom: 2rem;
  gap: 16px;
  background: var(--field-bg);
  border: 1px solid var(--field-border);
  border-radius: 18px;
  padding: 20px;
  box-shadow: 0 8px 30px rgba(16, 24, 40, 0.08);
  backdrop-filter: blur(12px) saturate(160%);
  -webkit-backdrop-filter: blur(12px) saturate(160%);
  transition: all 0.25s ease;
}
#patientForm label { font-weight: 600; color: var(--text); font-size: 0.95rem; display: block; margin-bottom: 6px; }
#patientForm input[type="text"], #patientForm input[type="email"], #patientForm input[type="tel"], #patientForm input[type="number"], #patientForm input[type="date"], #patientForm select, #patientForm textarea, #patientForm input[type="password"] {
  width: 100%;
  border: 1px solid var(--field-border);
  background: rgba(255, 255, 255, 0.9);
  border-radius: 12px;
  padding: 12px 14px;
  font: inherit;
  color: var(--text);
  transition: border-color 0.2s ease, box-shadow 0.25s ease, background 0.25s ease;
  outline: none;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.02) inset;
}
#patientForm input:hover, #patientForm textarea:hover, #patientForm select:hover {
  background: rgba(255, 255, 255, 0.95);
  border-color: rgba(180, 196, 225, 0.9);
}
#patientForm input::placeholder, #patientForm textarea::placeholder { color: var(--muted); }
#patientForm input:focus, #patientForm select:focus, #patientForm textarea:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 4px var(--ring);
  background: #fff;
}
#patientForm textarea { min-height: 120px; resize: vertical; }
#patientForm .error-text { display: none; color: #dc2626; font-size: 0.85rem; margin-top: 6px; }
#patientForm input:invalid:focus, #patientForm textarea:invalid:focus { border-color: #dc2626; box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.15); }
#appt-title { text-align: center; color: var(--primary); }

/* two-column on wider screens */
@media (min-width: 700px) {
  #patientForm .row { display: grid; gap: 16px; grid-template-columns: 1fr 1fr; }
}
@media (max-width: 480px) {
  #patientForm { padding: 14px; border-radius: 14px; gap: 12px; backdrop-filter: blur(10px) saturate(140%); }
}
@media (prefers-reduced-motion: reduce) {
  #patientForm, #patientForm * { transition: none !important; animation: none !important; }
}

/* small helpers */
.form-note { color: #6b7280; font-size: 0.9rem; margin-top: 6px; }
.btn { display:inline-block; padding:10px 14px; border-radius:8px; font-weight:600; text-decoration:none; border:0; cursor:pointer; }
.btn-primary { background: var(--primary); color: #fff; }
.btn-ghost { background: transparent; border: 1px solid var(--field-border); color: var(--text); }
.status-pill { display:inline-block; padding:6px 10px; border-radius:999px; font-weight:700; font-size:0.85rem; }
#messageBox { padding:12px; border-radius:10px; display:none; margin-top:10px; }
#messageBox.success { background: #ecfdf5; color:#065f46; border:1px solid #bbf7d0; display:block; }
#messageBox.error { background: #fff1f2; color:#9f1239; border:1px solid #fecaca; display:block; }
</style>

<main>
  <h1 id="appt-title">Confirm / Reschedule Appointment</h1>

  <form id="patientForm" method="get" novalidate>
    <!-- Hidden fields populated from URL / JS -->
    <input type="hidden" name="appointmentId" id="appointmentId" value="">

    <div class="row">
      <div>
        <label>Appointment ID</label>
        <input type="text" id="displayAppointmentId" readonly placeholder="— appointment id —">
        <div class="form-note">This is the appointment identifier; it will be sent to the update endpoint.</div>
      </div>

      <div>
        <label>Current status (public)</label>
        <div id="currentStatus" class="status-pill">pending</div>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="password">Doctor Password</label>
        <input id="password" name="password" type="password" required placeholder="Enter your doctor password">
        <div class="form-note">Your password authenticates you — it is hashed server-side before verification.</div>
      </div>

      <div>
        <label for="newStatus">New status</label>
        <select id="newStatus" name="newStatus">
          <option value="">-- no change --</option>
          <option value="confirmed">confirmed</option>
          <option value="rescheduled">rescheduled</option>
          <option value="cancelled">cancelled</option>
        </select>
        <div class="form-note">Choose "rescheduled" to change date/time, or "confirmed" when fixed.</div>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="appDate">Appointment date</label>
        <input id="appDate" name="appDate" type="date" placeholder="YYYY-MM-DD">
        <div class="form-note">Pick a date (leave blank if not changing).</div>
      </div>

      <div>
        <label for="appTime">Appointment time</label>
        <input id="appTime" name="appTime" type="time" placeholder="HH:MM">
        <div class="form-note">24-hour time recommended (e.g. 09:30).</div>
      </div>
    </div>

    <div class="row">
      <div style="grid-column: 1 / -1;">
        <label for="auditNote">Note (audit)</label>
        <input id="auditNote" name="auditNote" type="text" placeholder="Optional note for audit / reason">
      </div>
    </div>

    <div style="display:flex; gap:8px; align-items:center; margin-top:6px;">
      <button id="saveBtn" type="button" class="btn btn-primary">Open Update (no CORS)</button>
      <button id="cancelBtn" type="button" class="btn btn-ghost">Clear</button>
      <div style="flex:1"></div>
      <a id="backLink" href="/" class="form-note">Back to site</a>
    </div>

    <div id="messageBox" role="status" aria-live="polite"></div>

    <noscript>
      <div class="form-note">JavaScript is required for best experience. Without JS, the form will do a normal GET submit.</div>
    </noscript>
  </form>
</main>

<script>
/*
  Updated update-appointment page script
  - Reads appointmentId from URL query params and fills the form
  - Sends updates by opening the Apps Script webapp URL with query params (GET) to avoid CORS
  - Replace WEBAPP_URL with your Apps Script exec URL if needed
  - NOTE: sending password in the URL exposes it in browser history/logs — consider POST if that is unacceptable
*/
(function(){
  // Replace this with your Apps Script "Appointments" webapp exec URL
  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycby-MaxKBJvjDCUThFIP9JL3lwnKiFwufcy6Pm7jyqYqMe7PTjA1bWIb56KwPwo8Oe-Ywg/exec";

  const form = document.getElementById('patientForm');
  const appointmentIdInput = document.getElementById('appointmentId');
  const displayAppointmentId = document.getElementById('displayAppointmentId');
  const passwordInput = document.getElementById('password');
  const newStatusInput = document.getElementById('newStatus');
  const appDateInput = document.getElementById('appDate');
  const appTimeInput = document.getElementById('appTime');
  const auditNoteInput = document.getElementById('auditNote');
  const saveBtn = document.getElementById('saveBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const messageBox = document.getElementById('messageBox');
  const currentStatusPill = document.getElementById('currentStatus');

  function qParams() {
    const s = location.search.substring(1);
    const o = {};
    if (!s) return o;
    s.split("&").forEach(function(pair) {
      const kv = pair.split("=");
      const k = decodeURIComponent(kv[0] || "");
      const v = decodeURIComponent(kv[1] || "");
      if (k) o[k] = v;
    });
    return o;
  }

  function showMessage(text, type) {
    messageBox.className = "";
    if (type === "success") {
      messageBox.classList.add("success");
      messageBox.textContent = text;
    } else {
      messageBox.classList.add("error");
      messageBox.textContent = text;
    }
    messageBox.style.display = 'block';
  }

  function clearMessage() {
    messageBox.style.display = 'none';
    messageBox.className = "";
    messageBox.textContent = "";
  }

  // Prefill fields from incoming link: ?appointmentId=AS6&status=pending&appDate=2025-10-30&appTime=09:30
  const params = qParams();
  if (params.appointmentId) {
    appointmentIdInput.value = params.appointmentId;
    displayAppointmentId.value = params.appointmentId;
  }
  if (params.status) currentStatusPill.textContent = params.status;
  if (params.appDate) appDateInput.value = params.appDate;
  if (params.appTime) appTimeInput.value = params.appTime;

  // Clear button
  cancelBtn.addEventListener('click', function(){
    form.reset();
    appointmentIdInput.value = params.appointmentId || "";
    displayAppointmentId.value = params.appointmentId || "";
    appDateInput.value = params.appDate || "";
    appTimeInput.value = params.appTime || "";
    clearMessage();
  });

  // Basic validation
  function validate() {
    if (!appointmentIdInput.value) { showMessage("Missing appointmentId in URL (use ?appointmentId=AS6).", "error"); return false; }
    if (!passwordInput.value) { showMessage("Password is required.", "error"); return false; }
    if (!newStatusInput.value && !appDateInput.value && !appTimeInput.value && !auditNoteInput.value) {
      showMessage("Nothing to update. Change status, date/time or add a note.", "error"); return false;
    }
    return true;
  }

  // Build query string (skip empty values)
  function toQuery(obj) {
    return Object.keys(obj).filter(k => obj[k] !== undefined && obj[k] !== null && String(obj[k]).length > 0)
      .map(k => encodeURIComponent(k) + "=" + encodeURIComponent(String(obj[k])))
      .join("&");
  }

  // Open the webapp URL with query params (GET) in a new tab to avoid CORS
  saveBtn.addEventListener('click', function(){
    clearMessage();
    if (!validate()) return;

    const payload = {
      appointmentId: appointmentIdInput.value,
      password: passwordInput.value,   // will be visible in URL
      newStatus: newStatusInput.value,
      appDate: appDateInput.value,
      appTime: appTimeInput.value,
      auditNote: auditNoteInput.value
    };

    const qs = toQuery(payload);
    const target = WEBAPP_URL + (qs ? ("?" + qs) : "");

    saveBtn.disabled = true;
    saveBtn.textContent = "Opening...";

    // Open in new tab — cannot read response due to cross-origin, instruct user to check new tab
    const win = window.open(target, '_blank');
    setTimeout(function(){ saveBtn.disabled = false; saveBtn.textContent = "Open Update (no CORS)"; }, 800);

    if (win) {
      showMessage("Update opened in a new tab. Enter password on the page if prompted and follow server response there.", "success");
      try { win.focus(); } catch(e) {}
    } else {
      showMessage("Popup blocked — navigating this tab to the update URL.", "error");
      window.location.href = target;
    }
  });

  // Progressive enhancement: set form action to WEBAPP_URL and method=get so non-JS fallback works
  form.setAttribute('action', WEBAPP_URL);
  form.setAttribute('method', 'get');

})();
</script>

