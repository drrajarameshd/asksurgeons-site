{%- comment -%}
_layouts/post.html
Final production-ready post layout for doctor-authored posts.
Uses JSON-LD (BlogPosting) as the single canonical schema (mainEntityOfPage).
No microdata/itemprop attributes in body to avoid duplicate schema signals.
Assumes your _data/doctors.yml contains doctor entries matched by page.author-id.
Uses site.banner as fallback for article image / publisher logo.
{%- endcomment -%}
<!doctype html>
<html lang="en-IN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

  <title>{{ page.title | escape }}</title>
  <link rel="canonical" href="{{ page.url | absolute_url }}">

  <meta name="description" content="{{ page.excerpt | strip_html | strip_newlines | truncate:160 | escape }}">
  <meta name="theme-color" content="#007BBF">

  <link rel="icon" href="{{ '/assets/images/site-images/logo.webp' | relative_url }}" type="image/webp">
  <link rel="apple-touch-icon" href="{{ '/assets/images/site-images/logo.webp' | relative_url }}">

  {%- comment -%}
  Robust article URL + image selection (falls back to commonly used front-matter keys and site.banner)
  {%- endcomment -%}
  {%- assign article_url_candidate = page.url | default: page.permalink | default: page.path -%}
  {%- assign article_url = article_url_candidate | absolute_url -%}
  {%- assign article_image_candidate = page.image | default: page.thumbnail | default: page.featured_image | default: page.header.image | default: site.banner -%}
  {%- assign article_image = article_image_candidate | absolute_url -%}

  <meta property="og:type" content="article">
  <meta property="og:site_name" content="{{ site.title | escape }}">
  <meta property="og:title" content="{{ page.title | escape }}">
  <meta property="og:description" content="{{ page.excerpt | strip_html | strip_newlines | truncate:300 | escape }}">
  <meta property="og:url" content="{{ article_url }}">
  <meta property="og:image" content="{{ article_image }}">
  <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">
  {%- if page.last_modified_at -%}
  <meta property="article:modified_time" content="{{ page.last_modified_at | date_to_xmlschema }}">
  {%- endif -%}
  {%- if page.tags -%}
    {%- for t in page.tags -%}
  <meta property="article:tag" content="{{ t | escape }}">
    {%- endfor -%}
  {%- endif -%}

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ page.title | escape }}">
  <meta name="twitter:description" content="{{ page.excerpt | strip_html | strip_newlines | truncate:200 | escape }}">
  <meta name="twitter:image" content="{{ article_image }}">
  {%- if site.twitter_username -%}
  <meta name="twitter:site" content="@{{ site.twitter_username | replace: '@', '' }}">
  {%- endif -%}

  {%- assign doctor = site.data.doctors | where: "id", page.author-id | first -%}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ article_url | jsonify }}
  },
  "headline": {{ page.title | jsonify }},
  "description": {{ page.excerpt | strip_html | strip_newlines | truncate:300 | jsonify }},
  "url": {{ article_url | jsonify }},
  "datePublished": {{ page.date | date_to_xmlschema | jsonify }}{%- if page.last_modified_at -%},
  "dateModified": {{ page.last_modified_at | date_to_xmlschema | jsonify }}{%- endif -%},
  "image": {
    "@type": "ImageObject",
    "url": {{ article_image | jsonify }}
  },

  "publisher": {
    "@type": "MedicalOrganization",
    "name": {{ site.title | jsonify }},
    "url": {{ site.url | jsonify }},
    "logo": {
      "@type": "ImageObject",
      "url": {{ site.logo | absolute_url | jsonify }}
    },
    "sameAs": [
      "https://asksurgeons.com",
      "https://www.instagram.com/asksurgeons/",
      "https://wa.me/+918062182411"
    ],
    "telephone": "+91 8062182411",
    "contactPoint": [
      {
        "@type": "ContactPoint",
        "telephone": "+91 8062182411",
        "contactType": "customer service",
        "areaServed": "IN",
        "availableLanguage": ["en", "te"]
      }
    ],
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Hyderabad",
      "addressRegion": "Telangana",
      "addressCountry": "IN"
    }
  },

  "author": {
    "@type": "Physician",
    "@id": {{ (site.url | append: "/doctors#" | append: doctor.id) | jsonify }},
    "name": {{ doctor.name | jsonify }},
    "jobTitle": {{ doctor.speciality | jsonify }},
    "medicalSpecialty": {{ doctor.speciality | jsonify }},
    "affiliation": {
      "@type": "MedicalOrganization",
      "name": {{ site.title | jsonify }},
      "url": {{ site.url | jsonify }}
    },

    "address": {
      "@type": "PostalAddress",
      "addressLocality": {{ doctor.location | default: "Hyderabad" | jsonify }},
      "addressRegion": "Telangana",
      "addressCountry": "IN"
    }{% comment %} optional doctor fields below {% endcomment %}{% assign author_props = "" %}

    {%- if doctor.image -%}
      {%- capture author_props -%}{{ author_props }}{% if author_props != "" %}, {% endif %}"image": {"@type":"ImageObject","url": {{ doctor.image | absolute_url | jsonify }}}{% endcapture -%}
    {%- endif -%}

    {%- if doctor.profile_url -%}
      {%- capture author_props -%}{{ author_props }}{% if author_props != "" %}, {% endif %}"url": {{ doctor.profile_url | absolute_url | jsonify }}{% endcapture -%}
    {%- endif -%}

    {%- assign degree_part = doctor.degree | join: ', ' | default: "" -%}
    {%- assign dept_part = doctor.department | default: "" -%}
    {%- assign bio_part = doctor.bio | default: "" -%}
    {%- assign exp_part = doctor.experience | default: "" -%}
    {%- assign desc_parts = degree_part -%}
    {%- if dept_part != "" -%}{% assign desc_parts = desc_parts | append: " — " | append: dept_part %}{% endif -%}
    {%- if bio_part != "" -%}{% assign desc_parts = desc_parts | append: " — " | append: bio_part %}{% endif -%}
    {%- if exp_part != "" -%}{% assign desc_parts = desc_parts | append: " — " | append: exp_part | append: " years experience" %}{% endif -%}

    {%- if desc_parts != "" -%}
      {%- capture author_props -%}{{ author_props }}{% if author_props != "" %}, {% endif %}"description": {{ desc_parts | strip_html | strip_newlines | truncate:800 | jsonify }}{% endcapture -%}
    {%- endif -%}

    {%- if doctor.services and doctor.services.size > 0 -%}
      {%- capture services_json -%}{{ doctor.services | jsonify }}{% endcapture -%}
      {%- capture author_props -%}{{ author_props }}{% if author_props != "" %}, {% endif %}"knowsAbout": {{ services_json }}{% endcapture -%}
    {%- endif -%}

    {%- if doctor.tags and doctor.tags.size > 0 -%}
      {%- capture author_props -%}{{ author_props }}{% if author_props != "" %}, {% endif %}"keywords": {{ doctor.tags | join: ', ' | jsonify }}{% endcapture -%}
    {%- endif -%}

    {%- if doctor.languages and doctor.languages.size > 0 -%}
      {%- capture author_props -%}{{ author_props }}{% if author_props != "" %}, {% endif %}"knowsLanguage": {{ doctor.languages | jsonify }}{% endcapture -%}
    {%- endif -%}

    {%- if author_props != "" -%},{% endif -%}
    {{ author_props }}
  }
}
</script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7L1KNKJJ87"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-7L1KNKJJ87');
  </script>

  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/post-layout.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/doctors.css' | relative_url }}">
</head>

<body>
  {% include header.html %}

  <main class="content post-layout-root" id="main">
    <div class="wrap">
      <article class="post single-post">
        <header class="post-header">
          <h1>{{ page.title }}</h1>
          <p class="meta">
            <time datetime="{{ page.date | date_to_xmlschema }}">
              {{ page.date | date: "%B %-d, %Y" }}
            </time>
            {%- if page.author or site.author.name -%}
            • <span>{{ page.author | default: site.author.name }}</span>
            {%- endif -%}
          </p>
        </header>

        <div class="post-body">
          {{ content }}
        </div>

        <div class="post-actions wrap">
          <a class="btn btn--primary" href="#"
             onclick="
               if (navigator.share) {
                 navigator.share({
                   title: '{{ page.title | escape }}',
                   text: 'Check this out:',
                   url: '{{ page.url | absolute_url }}'
                 }).catch((error) => console.log('Error sharing:', error));
               } else {
                 navigator.clipboard.writeText('{{ page.url | absolute_url }}')
                   .then(() => alert('Link copied to clipboard!'))
                   .catch(() => alert('Could not copy link. Please try manually.'));
               }
               return false;">
            Share
          </a>
          <a class="btn btn--primary" href="{{ '/appointment' | relative_url }}">Appointment</a>
        </div>

        <hr />
        <div class="post-footer wrap">
          <p><a class="back-link" href="{{ '/' | relative_url }}">← Back to blog</a></p>
          <p class="meta">© <span id="year"></span> {{ site.title }}</p>
        </div>
      </article>
    </div>
  </main>

  <script>
    (function () {
      var h = document.querySelector('.post-header h1');
      if (h) h.setAttribute('tabindex', '-1');
      var y = document.getElementById('year');
      if (y) y.textContent = new Date().getFullYear();
    })();
  </script>

  {% include bottom-nav.html %}
  {% include footer.html %}

  <script src="{{ '/assets/js/main.js' | relative_url }}" defer></script>
</body>
</html>


